Executables for fmippn postprocessing of fmippn output
======================================================


ensmean_determweighted
______________________

Reads nc_YYYYmmddHHMM.h5 file generated by fmippn. The file contains
dBZ values for each member and deterministic nowcast.
The deterministic is just the latest observed radar composite
advected by the unperturbed motion field.

The program calculates the ensemble mean for each nowcast output
timestep. The weight of deterministic member DW as a function of lead time
can be adjusted by setting 
environment variables:

DETERM_INITWEIGHT 100 # Percentage of deterministic weight vs. member count
                      # 100 means determ having equal weight to all other members together
                      # in the beginning of the nowcast
DETERM_WEIGHTSPAN 200 # Time span percentage of nowcast length for determ weight. 100 means DW(leadtime)=0
                      # 200 means deterministic weight to drop to half from initial weight 
                      # at the end of the nowcast
                      # 50 would mean deterministic weight to drop to zero in the middle of the nowcast
                      # Use some huge percentage to set constant DW(t). 

Command line syntax: ensmean_determweighted ppn_output_file



thread_member_interp
____________________

Reads nc_YYYYmmddHHMM.h5 file generated by fmippn.

Interpolates dBZ fields between nowcast timesteps along motion field. Can use common or
perturped motion fields for each member.

Writes RAVAKE compatible cumulative accumulation as a function of lead time for each member
(can write also dBZ fields as PGM images for each interpolation time step, useful e.g. for demonstration animations,
and PGM images of cumulative accumulation for each nowcast time step)

Environment variables:

GENERATE_INTER_ACC  if True, generates PGM images of cumulative accumulation for each member
GENERATE_DBZ        if True, generates PGM images for each interpolation time step for each member 
PGM_SCALER 	    Scales accumulation values in 1/100 mm to PGM grey scale 0-255. Typical value is 1000
NC_ACCPREF          File name prefix for RAVAKE-compatible output data. E.g. RAVACC -> RAVACC_202002261035-202002261150+075_10.dat 

Command line syntax: thread_member_interp origintime ppn_output_file observed_composite output_dir interpolation_steps

The "ppn_output_file" and "observed_composite" should be of the timestamp "origintime"